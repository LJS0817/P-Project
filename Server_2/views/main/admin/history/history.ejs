<link rel="stylesheet" href="/css/main/listview.css" />
<link rel="stylesheet" href="/css/main/history/history.css" />
<link rel="stylesheet" href="/css/main/admin/history.css" />
<script src="/js/main/history/filterProject.js" defer></script>
<script src="/js/main/scroll.js" defer></script>
<script src="/js/main/sort.js" defer></script>
<div class="histories listParent">
    <div class="filterContainer">
        <h3>Filter</h3>
        <% 
            // 1. 프로젝트 목록 추출 (중복 제거)
            const uniqueProjects = [...new Set(history.map(item => item.project))].sort();

            const uniqueUsers = [...new Set(history.map(item => item.user))].sort();

            
            // 2. 페이지 목록 추출 (중복 제거)
            const uniquePages = [...new Set(history.map(item => item.page))].sort();
        %>
        <div class="filters">
            <div class="user filter-group" data-filter-key="user">
                <p>User</p>
                <div class="details">
                    <div class="filter active" onclick="filtering(this, true)">All</div>
                    <% uniqueUsers.forEach(user => { %>
                        <div class="filter" onclick="filtering(this)"><%= user %></div>
                    <% }); %>
                    <!-- <div class="filter" onclick="filtering(this)">Test</div> -->
                </div>
            </div>
            <hr>
            <div class="projectName filter-group" data-filter-key="project">
                <p>Project</p>
                <div class="details">
                    <div class="filter active" onclick="filtering(this, true)">All</div>
                    <% uniqueProjects.forEach(project => { %>
                        <div class="filter" onclick="filtering(this)"><%= project %></div>
                    <% }); %>
                    <!-- <div class="filter" onclick="filtering(this)">Test</div> -->
                </div>
            </div>
            <hr>
            <div class="pageName filter-group" data-filter-key="page">
                <p>Page</p>
                <div class="details">
                    <div class="filter active" onclick="filtering(this, true)">All</div>
                    <% uniquePages.forEach(page => { %>
                        <div class="filter" onclick="filtering(this)"><%= page %></div>
                    <% }); %>
                </div>
            </div>
            <hr>
            <div class="date">
                <p>Date</p>
                <div class="dateSelector">
                    <input type="date" name="startDate" id="startDate">
                    <span>~</span>
                    <input type="date" name="endDate" id="endDate">
                </div>
            </div>
        </div>
    </div>
    <div class="result listParent">
        <div class="categories linked">
            <p class="sortable">Date<span class="arrow">▼</span></p>
            <p class="sortable">User<span class="arrow">▼</span></p>
            <p class="sortable">Project name<span class="arrow">▼</span></p>
            <p class="sortable">Page name<span class="arrow">▼</span></p>
        </div>
        <div class="historyContainer listContainer">
            <div class="historyList list">
                <% history.forEach(hist => { %>
                    <%- include('historyContainer', {
                        date: hist.date,
                        user: hist.user,
                        project: hist.project,
                        page: hist.page,
                    }) %>
                <% }); %>
            </div>
            <div class="scrollBar" id="customScroll"></div>
        </div>
    </div>
</div>